1. –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –¥–∞–Ω—ñ:
–°—Ç–≤–æ—Ä—ñ—Ç—å —Å—Ö–µ–º—É pandemic —É –±–∞–∑—ñ –¥–∞–Ω–∏—Ö –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é SQL-–∫–æ–º–∞–Ω–¥–∏.
–û–±–µ—Ä—ñ—Ç—å —ó—ó —è–∫ —Å—Ö–µ–º—É –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é SQL-–∫–æ–º–∞–Ω–¥–∏.
–Ü–º–ø–æ—Ä—Ç—É–π—Ç–µ –¥–∞–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é Import wizard —Ç–∞–∫, —è–∫ –≤–∏ –≤–∂–µ —Ä–æ–±–∏–ª–∏ —Ü–µ —É —Ç–µ–º—ñ 3.
infectious_cases.csv

create schema pandemic;
use pandemic;
___________________________________________________________________________

2. –ù–æ—Ä–º–∞–ª—ñ–∑—É–π—Ç–µ —Ç–∞–±–ª–∏—Ü—é infectious_cases. –ó–±–µ—Ä–µ–∂—ñ—Ç—å —É —Ü—ñ–π –∂–µ —Å—Ö–µ–º—ñ –¥–≤—ñ —Ç–∞–±–ª–∏—Ü—ñ –∑ –Ω–æ—Ä–º–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏.

2_1 –°—Ç–≤–æ—Ä—é—é —Ç–∞–±–ª–∏—Ü—é entity –∑ —Ç–∞–∫–∏–º–∏ –∂ –Ω–∞–∑–≤–∞–º–∏ –∫–æ–ª–æ–Ω–æ–∫, —è–∫ —ñ —Ç—ñ, —â–æ –ø–ª–∞–Ω—É—é –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç–∏ –∑ —Ç–∞–±–ª–∏—Ü—ñ infectious_cases.
–ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞–≤—à–∏ –¥–∞–Ω—ñ, –¥—ñ–π—à–ª–∞ –¥–æ –≤–∏—Å–Ω–æ–≤–∫—É, —â–æ Code –º–∞—î –±—É—Ç–∏ –ø–µ—Ä—à–∏–Ω–Ω–∏–º –∫–ª—é—á–µ–º:

create table entity(
	Code varchar(50) unique primary key,
    	Entity varchar(50) unique
);

2_2 –í—Å—Ç–∞–≤–ª—é—é —É–Ω—ñ–∫–∞–ª—å–Ω—ñ –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó –∑–Ω–∞—á–µ–Ω—å –∑ –∫–æ–ª–æ–Ω–æ–∫ Entity —ñ Code –∑ —Ç–∞–±–ª–∏—Ü—ñ infectious_cases –≤ —Ç–∞–±–ª–∏—Ü—é entity:

insert into entity (Entity, Code)
select distinct Entity, Code
from infectious_cases;

2_3 –†–æ–±–ª—é –∑ –∫–æ–ª–æ–Ω–∫–∏ Code –≤ —Ç–∞–±–ª–∏—Ü—ñ infectious_cases –∑–æ–≤–Ω—ñ—à–Ω—ñ–π –∫–ª—é—á –ø—ñ–¥ –Ω–∞–∑–≤–æ—é entity_code:

alter table infectious_cases
change column Code entity_code varchar(50),
add foreign key (entity_code) references entity(Code);

2_4 –†–æ–±–ª—é –ø–µ—Ä–µ–≤—ñ—Ä–∫—É, —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º —è–∫–æ—ó –±—É–¥–µ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤, —è–∫—ñ –º–∞—é—Ç—å –Ω–µ—Å–ø—ñ–≤–ø–∞–¥–∞—é—á—ñ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ –∫–æ–ª–æ–Ω—Ü—ñ Entity 
–º—ñ–∂ —Ç–∞–±–ª–∏—Ü—è–º–∏ infectious_cases —ñ entity, –∞–±–æ –¥–ª—è —è–∫–∏—Ö –≤—ñ–¥—Å—É—Ç–Ω—î –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –≤ —Ç–∞–±–ª–∏—Ü—ñ entity.

select COUNT(*) as mismatch_count
from infectious_cases as inf
left join entity as ent on inf.entity_code = ent.Code
where inf.Entity != ent.Entity or ent.Code is null;

2_5 –¢–∞–∫ —è–∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —î 0, —Ç–æ –≤–∏–¥–∞–ª—è—î–º–æ –∑–∞–π–≤–∏–π –∞—Ç—Ä–∏–±—É—Ç Entity –∑ —Ç–∞–±–ª–∏—Ü—ñ infectious_cases:

alter table infectious_cases
drop column Entity;

2_6 –ü–µ—Ä–µ–π–º–µ–Ω—É–≤–∞–ª–∞ –¥–≤–∞ –∞—Ç—Ä–∏–±—É—Ç–∞, —â–æ–± –ø—Ä–∏–≤–µ—Å—Ç–∏ –¥–æ —î–¥–∏–Ω–æ–≥–æ —Ñ—ñ—Ä–º–∞—Ç—É –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –∞—Ç—Ä–∏–±—É—Ç—ñ–≤:

alter table  infectious_cases
	change column polio_cases Polio_cases int default 0,
	change column cases_guinea_worm Cases_guinea_worm int default 0
;
___________________________________________________________________________

3. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π—Ç–µ –¥–∞–Ω—ñ:
–î–ª—è –∫–æ–∂–Ω–æ—ó —É–Ω—ñ–∫–∞–ª—å–Ω–æ—ó –∫–æ–º–±—ñ–Ω–∞—Ü—ñ—ó Entity —Ç–∞ Code –∞–±–æ —ó—Ö id –ø–æ—Ä–∞—Ö—É–π—Ç–µ —Å–µ—Ä–µ–¥–Ω—î, 
–º—ñ–Ω—ñ–º–∞–ª—å–Ω–µ, –º–∞–∫—Å–∏–º–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ —Å—É–º—É –¥–ª—è –∞—Ç—Ä–∏–±—É—Ç–∞ Number_rabies.
üí° –í—Ä–∞—Ö—É–π—Ç–µ, —â–æ –∞—Ç—Ä–∏–±—É—Ç Number_rabies –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ –∑–Ω–∞—á–µ–Ω–Ω—è ‚Äò‚Äô ‚Äî –≤–∞–º –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ —ó—Ö –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏.

–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ñ–¥—Å–æ—Ä—Ç—É–π—Ç–µ –∑–∞ –ø–æ—Ä–∞—Ö–æ–≤–∞–Ω–∏–º —Å–µ—Ä–µ–¥–Ω—ñ–º –∑–Ω–∞—á–µ–Ω–Ω—è–º —É –ø–æ—Ä—è–¥–∫—É —Å–ø–∞–¥–∞–Ω–Ω—è.
–û–±–µ—Ä—ñ—Ç—å —Ç—ñ–ª—å–∫–∏ 10 —Ä—è–¥–∫—ñ–≤ –¥–ª—è –≤–∏–≤–µ–¥–µ–Ω–Ω—è –Ω–∞ –µ–∫—Ä–∞–Ω.

select
	ent.Code,
    ent.Entity,
    avg(inf.Number_rabies) as avg_rabies,
    min(inf.Number_rabies) as min_rabies,
    max(inf.Number_rabies) as max_rabies,
    sum(inf.Number_rabies) as sum_rabies
from
	entity as ent
join
	infectious_cases as inf 
    on ent.Code = inf.entity_code
where
	inf.Number_rabies <> ''
group by
	ent.Code, ent.Entity
order by
     avg_rabies desc
limit 10;

___________________________________________________________________________

4. –ü–æ–±—É–¥—É–π—Ç–µ –∫–æ–ª–æ–Ω–∫—É —Ä—ñ–∑–Ω–∏—Ü—ñ –≤ —Ä–æ–∫–∞—Ö.

–î–ª—è –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ—ó –∞–±–æ –Ω–æ—Ä–º–æ–≤–∞–Ω–æ—ó —Ç–∞–±–ª–∏—Ü—ñ –¥–ª—è –∫–æ–ª–æ–Ω–∫–∏ Year –ø–æ–±—É–¥—É–π—Ç–µ –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö SQL-—Ñ—É–Ω–∫—Ü—ñ–π:

–∞—Ç—Ä–∏–±—É—Ç, —â–æ —Å—Ç–≤–æ—Ä—é—î –¥–∞—Ç—É –ø–µ—Ä—à–æ–≥–æ —Å—ñ—á–Ω—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ —Ä–æ–∫—É,
üí° –ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –∞—Ç—Ä–∏–±—É—Ç –º—ñ—Å—Ç–∏—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è ‚Äô1996‚Äô, —Ç–æ –∑–Ω–∞—á–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ –º–∞—î –±—É—Ç–∏ ‚Äò1996-01-01‚Äô.
–∞—Ç—Ä–∏–±—É—Ç, —â–æ –¥–æ—Ä—ñ–≤–Ω—é—î –ø–æ—Ç–æ—á–Ω—ñ–π –¥–∞—Ç—ñ,
–∞—Ç—Ä–∏–±—É—Ç, —â–æ –¥–æ—Ä—ñ–≤–Ω—é—î —Ä—ñ–∑–Ω–∏—Ü—ñ –≤ —Ä–æ–∫–∞—Ö –¥–≤–æ—Ö –≤–∏—â–µ–∑–≥–∞–¥–∞–Ω–∏—Ö –∫–æ–ª–æ–Ω–æ–∫.
üí° –ü–µ—Ä–µ—Ä–∞—Ö–æ–≤—É–≤–∞—Ç–∏ –≤—Å—ñ —ñ–Ω—à—ñ –∞—Ç—Ä–∏–±—É—Ç–∏, —Ç–∞–∫—ñ —è–∫ Number_malaria, –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ.

üëâüèº –î–ª—è –ø–æ—à—É–∫—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–∏—Ö –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π –≤–∞–º –º–æ–∂–µ –∑–Ω–∞–¥–æ–±–∏—Ç–∏—Å—è –º–∞—Ç–µ—Ä—ñ–∞–ª –¥–æ —Ç–µ–º–∏ 7.


alter table infectious_cases
add column year_new_format date,
add column now_date date,
add column difference_date int;

-- set sql_safe_updates = 0;

update infectious_cases
set year_new_format = str_to_date(concat(Year, '-01-01'), '%Y-%m-%d');

-- set sql_safe_updates = 1;

update infectious_cases
set now_date = curdate(),
    difference_date = timestampdiff(year, year_new_format, now_date);

___________________________________________________________________________

5. –ü–æ–±—É–¥—É–π—Ç–µ –≤–ª–∞—Å–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é.

–°—Ç–≤–æ—Ä—ñ—Ç—å —ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—é, —â–æ –±—É–¥—É—î —Ç–∞–∫–∏–π –∂–µ –∞—Ç—Ä–∏–±—É—Ç, —è–∫ —ñ –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É –∑–∞–≤–¥–∞–Ω–Ω—ñ: 
—Ñ—É–Ω–∫—Ü—ñ—è –º–∞—î –ø—Ä–∏–π–º–∞—Ç–∏ –Ω–∞ –≤—Ö—ñ–¥ –∑–Ω–∞—á–µ–Ω–Ω—è —Ä–æ–∫—É, –∞ –ø–æ–≤–µ—Ä—Ç–∞—Ç–∏ —Ä—ñ–∑–Ω–∏—Ü—é –≤ —Ä–æ–∫–∞—Ö –º—ñ–∂ –ø–æ—Ç–æ—á–Ω–æ—é –¥–∞—Ç–æ—é —Ç–∞ –¥–∞—Ç–æ—é, 
—Å—Ç–≤–æ—Ä–µ–Ω–æ—é –∑ –∞—Ç—Ä–∏–±—É—Ç–∞ —Ä–æ–∫—É (1996 —Ä—ñ–∫ ‚Üí ‚Äò1996-01-01‚Äô).


use pandemic;
drop function if exists YearDifferenceCount;

DELIMITER //

create function YearDifferenceCount(input_year int)
returns int
no sql
deterministic
begin
    declare year_new_format date;
    declare now_date date;

    
    set year_new_format = str_to_date(concat(input_year, '-01-01'), '%Y-%m-%d');
    set now_date = curdate();

    return timestampdiff(YEAR, year_new_format, now_date);
end//
DELIMITER ;

update infectious_cases
set difference_date = YearDifferenceCount(Year);
